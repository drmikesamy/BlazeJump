<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>BlazeJump</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <base href="/" />
    <link href="/css/app.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div class="loading-animation-container">
            <div class="loading-animation"></div>
        </div>
    </div>
    testing
    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        function encodeMessage(message) {
            let enc = new TextEncoder();
            return enc.encode(message);
        }

        function decodeMessage(message) {
            let dec = new TextDecoder();
            return dec.decode(message);
        }

        async function uint8ArrayToCryptoKey(uint8Array) {
            const keyArrayBuffer = uint8ArrayToArrayBuffer(uint8Array);
            const key = await crypto.subtle.importKey(
                'raw',
                keyArrayBuffer,
                { name: 'AES-CBC', length: 256 },
                false,
                ['encrypt', 'decrypt']
            );
            return key;
        }

        function uint8ArrayToArrayBuffer(uint8Array) {
            const buf = new ArrayBuffer(uint8Array.length - 1);
            for (let i = 1, strLen = uint8Array.length; i < strLen; i++) {
                buf[i] = uint8Array[i];
            }
            return buf;
        }

        function arrayBufferToString(buf) {
            return String.fromCharCode.apply(null, new Uint8Array(buf));
        }

        window.aesEncrypt = (plainText, sharedPoint, iv) => {
            return new Promise((resolve) => {
                var encryptText = async function () {
                    const key = await uint8ArrayToCryptoKey(sharedPoint);
                    let encrypted = await window.crypto.subtle.encrypt(
                        {
                            name: "AES-CBC",
                            iv: iv,
                        },
                        key,
                        plainText,
                    );
                    let encryptedUint8Array = arrayBufferToString(encrypted);
                    resolve(encryptedUint8Array);
                }
                encryptText();
            });
        }
        window.aesDecrypt = (cipherText, sharedPointString, ivString) => {
            return new Promise((resolve) => {
                var keyGen = async function () {
                    iv = encodeMessage(ivString);
                    let decrypted = await window.crypto.subtle.decrypt(
                        {
                            name: "AES-CBC",
                            iv
                        },
                        sharedPointString,
                        cipherText
                    );
                    let decodedMessage = decodeMessage(decrypted);
                    resolve(decodedMessage);
                }
                keyGen();
            });
        }
    </script>
    <environment names="Development">
        <script src="_framework/aspnetcore-browser-refresh.js"></script>
    </environment>
</body>

</html>
